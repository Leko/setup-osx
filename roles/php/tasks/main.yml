# TODO: include homebrew homebrew_packages={{ homebrew_packages }}
- name: Install Homebrew packages to build PHP
  homebrew: >
    name={{ item.name }}
    state={{ item.state | default('latest') }}
    install_options={{
      item.install_options | default() | join(',')
      if item.install_options is not string
      else item.install_options
    }}
  with_items: '{{ homebrew_packages }}'
  notify: brew doctor

- name: Install php versions
  shell: source ~/.bashrc && phpenv install {{ item.version }}
  with_items: '{{ php_versions }}'

- name: Set php version to {{ item.version }}
  shell: source ~/.bashrc && phpenv install {{ item.version }}
  with_items: '{{ php_versions }}'
  when: '{{ item.global | default(False) }}'
